<div class="panel panel-default">
    <div><header></header></div>
    <div class="panel-body">
        <div id="secao" class="text-center">
            <h1>Quiz do Estadão</h1>
            <p>Descrição...</p>
            <button name="start" class="btn btn-primary" onclick="iniciar()" type="button">Iniciar</button>
        </div>
    </div>
</div>

<%- contentFor("styles") %>
<style type="text/css" name="personalizado">

        header {
    		padding: 175px 25px 75px;
    		text-align: center;
    		background-image: url('<%- root %>/imagens/user.png'); /*imagem do quiz*/
   			background-size: cover;
   		 	background-position: center; 
		}

    	body {
			background-color: #fafafa;
		}

</style>

<%- contentFor("scripts") %>
<script type="text/javascript">
    var secao = $("#secao");
    var carregando = false;
    var questoes = [
        {
            "id": 100,
            "titulo": "Uma Pergunta",
            "alternativas": [
                {
                    "id": 101,
                    "texto": "a - Texto 1",
                    "correta": false
                },
                {
                    "id": 102,
                    "texto": "b - Texto 2",
                    "correta": false
                },
                {
                    "id": 103,
                    "texto": "c - Texto 3",
                    "correta": false
                },
                {
                    "id": 104,
                    "texto": "d - Texto 4 (eu sou a correta)",
                    "correta": true
                }
            ]
        },
        {
            "id": 200,
            "titulo": "Outra Pergunta",
            "alternativas": [
                {
                    "id": 201,
                    "texto": "a - Texto 1",
                    "correta": false
                },
                {
                    "id": 202,
                    "texto": "b - Texto 2 (eu sou a correta)",
                    "correta": true
                },
                {
                    "id": 203,
                    "texto": "c - Texto 3",
                    "correta": false
                },
                {
                    "id": 204,
                    "texto": "d - Texto 4",
                    "correta": false
                }
            ]
        },
        {
            "id": 300,
            "titulo": "Mais Uma Pergunta",
            "alternativas": [
                {
                    "id": 301,
                    "texto": "a - Texto 1",
                    "correta": false
                },
                {
                    "id": 302,
                    "texto": "b - Texto 2",
                    "correta": false
                },
                {
                    "id": 303,
                    "texto": "c - Texto 3 (eu sou a correta)",
                    "correta": true
                },
                {
                    "id": 304,
                    "texto": "d - Texto 4",
                    "correta": false
                }
            ]
        },
        {
            "id": 400,
            "titulo": "Pergunta Final",
            "alternativas": [
                {
                    "id": 401,
                    "texto": "a - Texto 1 (eu sou a correta)",
                    "correta": true
                },
                {
                    "id": 402,
                    "texto": "b - Texto 2",
                    "correta": false
                },
                {
                    "id": 403,
                    "texto": "c - Texto 3",
                    "correta": false
                },
                {
                    "id": 404,
                    "texto": "d - Texto 4",
                    "correta": false
                }
            ]
        }
    ];
    var questaoAtual = 0;
    var acertos = 0;
    var respostas = [];
    
    function atualizar() {
        if (carregando)
            return;
        
        carregando = true;
        
        if (questaoAtual < questoes.length) {
            secao.fadeOut(400, "swing", exibirProximaQuestao);
        } else {
            secao.fadeOut(400, "swing", exibirEspera);
        }
    }

    function iniciar() {
        secao.fadeIn(400, "swing", exibirProximaQuestao);
    }

    function exibirProximaQuestao() {
        var questao = questoes[questaoAtual];
        
        // Vamos construir o html aqui. Existem outras alternativas...
        var html = '<h2>' + questao.titulo + '</h2>';
        
        for (var i = 0; i < questao.alternativas.length; i++) {
            
            html += '<p class="radio">' +
                '<label>' +
                '<input type="radio" name="pergunta" onclick="habilitarBotao()" data-id="' +
                questao.alternativas[i].id +
                '" value="' +
                (questao.alternativas[i].correta ? '1' : '0') +
                '" /> ' +
                questao.alternativas[i].texto
                '</label>' +
                '</p>';
        }
        
        html += '<p><button id="botao-proximo" type="button" onclick="responder()" class="btn btn-default" disabled="disabled">Próxima</button></p>';
        
        secao.html(html);
        
        secao.fadeIn(400, "swing", function () {
            // Apenas para liberar o clique do botão!
            carregando = false;
        });
    }
    
    function habilitarBotao() {
        // Só habilita o botão quando selecionar alguma alternativa
        $("#botao-proximo").prop("disabled", false);
    }
    
    function responder() {
        // Vamos utilizar a variável carregando para prevenir
        // "dedos rápidos", que clicam em botões sem a animação
        // ter acabado!
        if (carregando)
            return;
        
        // Descobre se o usuário acertou
        var opcao = $("#secao input:checked");
        
        if (opcao.val() === "1")
            acertos++;
        
        // Armazena um objeto com o id da questão e da
        // resposta para enviar para o servidor ao final
        respostas.push({
            idQuestao: questoes[questaoAtual].id,
            idResposta: parseInt(opcao.attr("data-id"))
        });
        
        // Vai para a próxima questão ou para o final
        questaoAtual++;
        atualizar();
    }
    
    function exibirEspera() {
        var html = '<p>Aguarde enquanto carrega...</p>' +
            '<img alt="Aguarde" src="/imagens/aguarde.gif" />';
        
        secao.html(html);
        
        secao.fadeIn(400, "swing", enviarTotais);
    }
    
    function enviarTotais() {
        // @@@ apenas por hora
        secao.fadeOut(400, "swing", exibirTotais);
        /*
        $.ajax({
            // Na vida real, esta URL deveria apontar para
            // alguma API do servidor!!!
            url: "perguntas.json",
            method: "post",
            
            // Envia todas as respostas para o servidor
            data: JSON.stringify(respostas),
            contentType: "application/json",
            
            success: function (data) {
                secao.fadeOut(400, "swing", exibirTotais);
            },
            error: function () {
                secao.text("Algo saiu errado! Por favor, tente novamente mais tarde.");
            }
        });
        */
    }
    
    function exibirTotais() {
        var perc = Math.round(100 * acertos / questoes.length);
        
        // Vamos construir o html aqui. Existem outras alternativas...
        var html = '<h2>';
        if (perc >= 50)
            html += 'Parabéns!';
        else
            html += 'Não foi dessa vez.';
        html += '</h2>';
        
        html += '<div class="progress">' +
            '<div class="progress-bar progress-bar-striped ' +
            (perc >= 50 ? 'progress-bar-success' : 'progress-bar-danger') +
            ' active" role="progressbar" aria-valuenow="2" aria-valuemin="0" aria-valuemax="100" style="min-width: 2em; width: ' +
            perc +
            '%;">' +
            perc +
            '%</div>' +
            '</div>';
        
        html += '<p><button type="button" onclick="reiniciar()" class="btn btn-default">Fazer novamente</button></p>';
        
        secao.html(html);
        
        secao.fadeIn(400, "swing", function () {
            carregando = false;
        });
    }
    
    function reiniciar() {
        if (carregando)
            return;
        
        questaoAtual = 0;
        acertos = 0;
        respostas = [];
        atualizar();
    }
    
</script>
