<div class="row">
	<div class="col-lg-12">
		<div class="panel panel-default">
            <div><header></header></div>
            <div class="panel-body">
                <h1>Quiz teste do Estadão</h1>
                <h4>Descrição aqui!</h4>
            </div>
            <div class="panel-footer text-center">
                <button name="start" class="btn btn-primary" onclick="iniciar()" type="button">Iniciar</button>
            </div>

            <div class="panel-body">
                <script type="text/javascript">            
                    var secao = $("#secao");
                    var carregando = false;
                    var questoes = null;
                    var questaoAtual = 0;
                    var acertos = 0;
                    var respostas = [];
                    
                    function carregarQuestoes() {
                    //Puxando perguntas do jQuery:
                        $.ajax({
                            url: "questoes.json", //é esse o nome?
                            dataType: "json",
                            success: function (data) {
                                questoes = data;
                                atualizar();
                            },
                            fail: function () {
                                secao.text("Algo saiu errado! Por favor, tente novamente mais tarde.");
                            }
                        });
                    }
                    
                    function atualizar() {
                        if (carregando)
                            return;
                        
                        carregando = true;
                        
                        if (questaoAtual < questoes.length) {
                            secao.fadeOut(400, "swing", exibirProximaQuestao);
                        } else {
                            secao.fadeOut(400, "swing", exibirEspera);
                        }
                    }
                    function iniciar() {
                        secao.fadeIn(400, "swing", exibirProximaQuestao);
                    }

                    function exibirProximaQuestao() {
                        var questao = questoes[perguntaAtual];
                        
                        // Vamos construir o html aqui. Existem outras alternativas...
                        var html = '<h2>' + questao.titulo + '</h2>';
                        
                        for (var i = 0; i < questao.alternativas.length; i++) {
                            
                            html += '<p class="radio">' +
                                '<label>' +
                                '<input type="radio" name="pergunta" onclick="habilitarBotao()" data-id="' +
                                questao.alternativas[i].id +
                                '" value="' +
                                (questao.alternativas[i].correta ? '1' : '0') +
                                '" /> ' +
                                questao.alternativas[i].texto
                                '</label>' +
                                '</p>';
                        }
                        
                        html += '<p><button id="botao-proximo" type="button" onclick="responder()" class="btn btn-default" disabled="disabled">Próxima</button></p>';
                        
                        secao.html(html);
                        
                        secao.fadeIn(400, "swing", function () {
                            // Apenas para liberar o clique do botão!
                            carregando = false;
                        });
                    }
                    
                    function habilitarBotao() {
                        // Só habilita o botão quando selecionar alguma alternativa
                        $("#botao-proximo").prop("disabled", false);
                    }
                    
                    function responder() {
                        // Vamos utilizar a variável carregando para prevenir
                        // "dedos rápidos", que clicam em botões sem a animação
                        // ter acabado!
                        if (carregando)
                            return;
                        
                        // Descobre se o usuário acertou
                        var opcao = $("#secao input:checked");
                        
                        if (opcao.val() === "1")
                            acertos++;
                        
                        // Armazena um objeto com o id da pergunta e da
                        // resposta para enviar para o servidor ao final
                        respostas.push({
                            idQuestao: questoes[questaoAtual].id,
                            idResposta: parseInt(opcao.attr("data-id"))
                        });
                        
                        // Vai para a próxima pergunta ou para o final
                        questaoAtual++;
                        atualizar();
                    }
                    
                    function exibirEspera() {
                        var html = '<p>Aguarde enquanto carrega...</p>' +
                            '<img alt="Aguarde" src="aguarde.gif" />';
                        
                        secao.html(html);
                        
                        secao.fadeIn(400, "swing", enviarTotais);
                    }
                    
                    function enviarTotais() {
                        $.ajax({
                            // Na vida real, esta URL deveria apontar para
                            // alguma API do servidor!!!
                            url: "perguntas.json",
                            method: "post",
                            
                            // Envia todas as respostas para o servidor
                            data: JSON.stringify(respostas),
                            contentType: "application/json",
                            
                            success: function (data) {
                                secao.fadeOut(400, "swing", exibirTotais);
                            },
                            fail: function () {
                                secao.text("Algo saiu errado! Por favor, tente novamente mais tarde.");
                            }
                        });
                    }
                    
                    function exibirTotais() {
                        var perc = Math.round(100 * acertos / questoes.length);
                        
                        // Vamos construir o html aqui. Existem outras alternativas...
                        var html = '<h2>';
                        if (perc >= 50)
                            html += 'Parabéns!';
                        else
                            html += 'Não foi dessa vez.';
                        html += '</h2>';
                        
                        html += '<div class="progress">' +
                            '<div class="progress-bar progress-bar-striped ' +
                            (perc >= 50 ? 'progress-bar-success' : 'progress-bar-danger') +
                            ' active" role="progressbar" aria-valuenow="2" aria-valuemin="0" aria-valuemax="100" style="min-width: 2em; width: ' +
                            perc +
                            '%;">' +
                            perc +
                            '%</div>' +
                            '</div>';
                        
                        html += '<p><button type="button" onclick="reiniciar()" class="btn btn-default">Fazer novamente</button></p>';
                        
                        secao.html(html);
                        
                        secao.fadeIn(400, "swing", function () {
                            carregando = false;
                        });
                    }
                    
                    function reiniciar() {
                        if (carregando)
                            return;
                        
                        questaoAtual = 0;
                        acertos = 0;
                        respostas = [];
                        atualizar();
                    }
                    
                </script>
            </div>
    </div>
</div>

<%- contentFor("styles") %>
<style type="text/css" name="personalizado">

        header {
    		padding: 175px 25px 75px;
    		text-align: center;
    		background-image: url('<%- root %>/imagens/user.png'); /*imagem do quiz*/
   			background-size: cover;
   		 	background-position: center; 
		}

    	body {
			background-color: #fafafa;
		}

</style>
